name: Build VO-SE Pro

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  build-windows:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # 辞書データが欠落しないよう、pyopenjtalkを確実にインストール
        pip install numpy PySide6 pyinstaller
        pip install pyopenjtalk
        # 万が一dicが見つからないエラーが出る場合の予備としてフル版を試行
        pip install pyopenjtalk-quantized || echo "Alternative package not found, skipping."

    - name: Verify Dictionary Path
      shell: powershell
      run: |
        # 辞書がどこにインストールされたかログに出力して確認
        python -c "import pyopenjtalk; import os; print('DIC PATH:', os.path.join(os.path.dirname(pyopenjtalk.__file__), 'dic'))"
        python -c "import pyopenjtalk; import os; dic=os.path.join(os.path.dirname(pyopenjtalk.__file__), 'dic'); print('Exists:', os.path.exists(dic))"

    - name: Build C Engine DLL
      shell: powershell
      run: |
        # 出力先フォルダの作成
        if (!(Test-Path "bin")) { New-Item -ItemType Directory -Path "bin" }
        
        # Cソースをコンパイル
        if (Test-Path "src/vo_se
